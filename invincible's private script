-- ... (your existing code up to Anti-Lag button remains unchanged)

-- Shared rock farm function (CFrame teleport + equip + punch spam)
local function startRockFarm(toggleVar, rockName, requiredDurability)
    task.spawn(function()
        while _G[toggleVar] do
            pcall(function()
                local player = game.Players.LocalPlayer
                local char = player.Character
                if not char or not char:FindFirstChild("HumanoidRootPart") or not player:FindFirstChild("Durability") then
                    task.wait(1.5)
                    return
                end
                if player.Durability.Value < requiredDurability then
                    task.wait(2)
                    return
                end
                local hrp = char.HumanoidRootPart
                local found = false
                for _, obj in pairs(game.Workspace.machinesFolder:GetDescendants()) do
                    if obj:IsA("IntValue") and obj.Name == "neededDurability" and obj.Value == requiredDurability
                       and obj.Parent and obj.Parent:FindFirstChild("Rock")
                       and (rockName == "" or obj.Parent.Rock.Name == rockName) then
                        local rock = obj.Parent.Rock
                        local distance = (hrp.Position - rock.Position).Magnitude
                        if distance > 10 then
                            hrp.CFrame = rock.CFrame * CFrame.new(0, 3.5, -1.5)  -- offset for hitbox
                            found = true
                            task.wait(0.12)
                        end
                    end
                end
                if found then
                    local punchTool = player.Backpack:FindFirstChild("Punch") or char:FindFirstChild("Punch")
                    if punchTool and punchTool.Parent ~= char and char:FindFirstChild("Humanoid") then
                        char.Humanoid:EquipTool(punchTool)
                    end
                    local muscleEvent = player:FindFirstChild("muscleEvent")
                    if muscleEvent then
                        muscleEvent:FireServer("punch", "leftHand")
                        muscleEvent:FireServer("punch", "rightHand")
                    end
                end
                task.wait(found and 0.35 or 1.2)
            end)
        end
        -- Cleanup: return to safe area
        pcall(function()
            local player = game.Players.LocalPlayer
            local char = player.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                char.HumanoidRootPart.CFrame = CFrame.new(-10, 10, -200)  -- near spawn island
            end
        end)
    end)
end

-- Rock farm switches (Frost to Ancient Jungle)
Rocks:AddSwitch("Farm Frost Gym Rock (150K Dur)", function(state)
    _G.FarmFrostGym = state
    if state then startRockFarm("FarmFrostGym", "Frost Gym Rock", 150000) end
end)

Rocks:AddSwitch("Farm Mythical Gym Rock (400K Dur)", function(state)
    _G.FarmMythicalGym = state
    if state then startRockFarm("FarmMythicalGym", "Mythical Gym Rock", 400000) end
end)

Rocks:AddSwitch("Farm Eternal Gym Rock (750K Dur)", function(state)
    _G.FarmEternalGym = state
    if state then startRockFarm("FarmEternalGym", "Eternal Gym Rock", 750000) end
end)

Rocks:AddSwitch("Farm Legend Gym Rock (1M Dur)", function(state)
    _G.FarmLegendGym = state
    if state then startRockFarm("FarmLegendGym", "Legend Gym Rock", 1000000) end
end)

Rocks:AddSwitch("Farm Muscle King Gym Rock (5M Dur)", function(state)
    _G.FarmMuscleKingGym = state
    if state then startRockFarm("FarmMuscleKingGym", "Muscle King Gym Rock", 5000000) end
end)

Rocks:AddSwitch("Farm Ancient Jungle Rock (10M Dur)", function(state)
    _G.FarmAncientJungle = state
    if state then startRockFarm("FarmAncientJungle", "Ancient Jungle Rock", 10000000) end
end)

-- Optional: Any rock at 10M (ignores name check - useful if name varies)
Rocks:AddSwitch("Farm Any 10M Dur Rock (No Name)", function(state)
    _G.FarmAny10M = state
    if state then startRockFarm("FarmAny10M", "", 10000000) end
end)
