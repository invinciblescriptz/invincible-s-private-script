-- Invincible Paid - Cleaned & Fixed (Feb 2026 attempt)
-- Muscle Legends exploit GUI - many features likely patched/detected

local whitelistedUsers = {
    "hebdjxhc",
    "krxzy_214",
    "alexglover020",
    -- Add yourself here if testing
}

local Players           = game:GetService("Players")
local LocalPlayer       = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace         = game:GetService("Workspace")
local RunService        = game:GetService("RunService")
local UserInputService  = game:GetService("UserInputService")
local VirtualUser       = game:GetService("VirtualUser")

if not table.find(whitelistedUsers, LocalPlayer.Name) then
    LocalPlayer:Kick("not whitelisted L bozo dont steal my shit")
    return
end

-- UI Library (still exists on GitHub as of 2026 checks)
local librarySuccess, library = pcall(loadstring, game:HttpGet("https://raw.githubusercontent.com/memejames/elerium-v2-ui-library/main/Library", true))
if not librarySuccess or not library then
    warn("Failed to load UI library - script cannot run")
    return
end

local window = library:AddWindow("Invincible Paid 2026", {
    main_color = Color3.fromRGB(50, 50, 50),
    min_size = Vector2.new(540, 580),
    can_resize = true,
    background_transparency = 0.95,
})

-- Services & remotes
local muscleEvent   = LocalPlayer:WaitForChild("muscleEvent", 8)
local rEvents       = ReplicatedStorage:WaitForChild("rEvents", 8)
local rebirthRemote = rEvents and rEvents:FindFirstChild("rebirthRemote")

-- States
getgenv().NexusRunning = true

local states = {
    AutoPushups     = false,
    AutoWeight      = false,
    AutoHandstands  = false,
    FastPunch       = false,
    FastStrength    = false,
    InfiniteJump    = false,
    AntiAfk         = true,  -- safe & useful
    KillAura        = false,
    AutoKillSelected= false,
    AutoRebirth     = false,
    FastRebirth     = false,
    AutoSize2       = false,
    AutoMuscleKing  = false,
}

local vars = {
    targetRebirths       = 1,
    selectedTarget       = nil,
    rockFarmActive       = false,
    selectedRockDur      = 0,
    fastRebirthActive    = false,
    fastGrindActive      = false,
}

-- Connections & loops
local connections = {}
local loops = {}

local function addConnection(conn)
    table.insert(connections, conn)
end

local function addLoop(name, thread)
    if loops[name] then task.cancel(loops[name]) end
    loops[name] = thread
end

local function stopAll()
    getgenv().NexusRunning = false
    for _, c in connections do pcall(function() c:Disconnect() end) end
    for _, l in loops do pcall(task.cancel, l) end
end

-- Helpers
local function safeTp(pos)
    pcall(function()
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if hrp then hrp.CFrame = CFrame.new(pos) end
    end)
end

local function safeFireMuscle(name, ...)
    pcall(function() if muscleEvent then muscleEvent:FireServer(name, ...) end end)
end

local function startAutoRep(toolName, stateKey)
    addLoop(stateKey, task.spawn(function()
        while states[stateKey] and getgenv().NexusRunning do
            pcall(function()
                local char = LocalPlayer.Character
                if not char or not char:FindFirstChild("Humanoid") or char.Humanoid.Health <= 0 then
                    task.wait(1.5) return
                end
                local tool = LocalPlayer.Backpack:FindFirstChild(toolName) or char:FindFirstChild(toolName)
                if tool and tool.Parent ~= char then char.Humanoid:EquipTool(tool) end
                safeFireMuscle("rep")
            end)
            task.wait(0.08)
        end
    end))
end

-- Toggle functions
local fastStrengthConn
local function toggleFastStrength(s)
    states.FastStrength = s
    if s then
        if fastStrengthConn then fastStrengthConn:Disconnect() end
        fastStrengthConn = RunService.Heartbeat:Connect(function()
            pcall(function()
                safeFireMuscle("rep")
                safeFireMuscle("punch", "rightHand")
                safeFireMuscle("punch", "leftHand")
                local char = LocalPlayer.Character
                if char then
                    local tool = char:FindFirstChildWhichIsA("Tool")
                    if tool then tool:Activate() end
                end
            end)
        end)
        addConnection(fastStrengthConn)
    else
        if fastStrengthConn then fastStrengthConn:Disconnect() fastStrengthConn = nil end
    end
end

local jumpConn
local function toggleInfiniteJump(s)
    states.InfiniteJump = s
    if s then
        if jumpConn then return end
        jumpConn = UserInputService.JumpRequest:Connect(function()
            pcall(function()
                local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
                if hum then hum:ChangeState(Enum.HumanoidStateType.Jumping) end
            end)
        end)
        addConnection(jumpConn)
    else
        if jumpConn then jumpConn:Disconnect() jumpConn = nil end
    end
end

local antiAfkConn
local function toggleAntiAfk(s)
    states.AntiAfk = s
    if s then
        if antiAfkConn then return end
        antiAfkConn = LocalPlayer.Idled:Connect(function()
            VirtualUser:CaptureController()
            VirtualUser:ClickButton2(Vector2.new())
        end)
        addConnection(antiAfkConn)
    else
        if antiAfkConn then antiAfkConn:Disconnect() antiAfkConn = nil end
    end
end

local function killPlayer(target)
    pcall(function()
        local myChar = LocalPlayer.Character
        local tChar = target.Character
        if not myChar or not tChar then return end
        local myHRP = myChar:FindFirstChild("HumanoidRootPart")
        local tHRP = tChar:FindFirstChild("HumanoidRootPart")
        if myHRP and tHRP then
            myHRP.CFrame = tHRP.CFrame * CFrame.new(0, -25, 0)
        end
    end)
end

-- Rock farm loop
addLoop("rockFarm", task.spawn(function()
    while getgenv().NexusRunning do
        if not vars.rockFarmActive or vars.selectedRockDur <= 0 then
            task.wait(0.6) continue
        end
        pcall(function()
            local char = LocalPlayer.Character
            if not char or not char:FindFirstChild("Humanoid") or char.Humanoid.Health <= 0 then
                task.wait(1.2) return
            end
            local dur = LocalPlayer:FindFirstChild("Durability")
            if not dur or dur.Value < vars.selectedRockDur then task.wait(0.5) return end

            local hum = char:FindFirstChild("Humanoid")
            local punch = char:FindFirstChild("Punch") or LocalPlayer.Backpack:FindFirstChild("Punch")
            if hum and punch and punch.Parent ~= char then hum:EquipTool(punch) end

            local touched = false
            for _, obj in Workspace.machinesFolder:GetDescendants() do
                if obj.Name == "neededDurability" and obj:IsA("IntValue") and obj.Value == vars.selectedRockDur then
                    local rock = obj.Parent:FindFirstChild("Rock")
                    if rock and rock:IsA("BasePart") then
                        touched = true
                        if char:FindFirstChild("RightHand") then
                            firetouchinterest(rock, char.RightHand, 0) task.wait(0.025) firetouchinterest(rock, char.RightHand, 1)
                        end
                        if char:FindFirstChild("LeftHand") then
                            firetouchinterest(rock, char.LeftHand, 0) task.wait(0.025) firetouchinterest(rock, char.LeftHand, 1)
                        end
                    end
                end
            end
            if touched then
                safeFireMuscle("punch", "leftHand")
                safeFireMuscle("punch", "rightHand")
            end
        end)
        task.wait(0.15)
    end
end))

local function setRockFarm(dur, enable)
    if enable then
        vars.selectedRockDur = dur
        vars.rockFarmActive = true
    else
        if vars.selectedRockDur == dur then
            vars.rockFarmActive = false
            vars.selectedRockDur = 0
        end
    end
end

-- UI Tabs
local mainTab     = window:AddTab("Main")
local rebirthTab  = window:AddTab("Rebirth")
local teleportTab = window:AddTab("Teleport")
local statsTab    = window:AddTab("Stats")
local killerTab   = window:AddTab("Killer")
local miscTab     = window:AddTab("Misc")

local toolsFolder    = mainTab:AddFolder("Tools")
local rockFarmFolder = mainTab:AddFolder("Rock Farm")
local killFolder     = killerTab:AddFolder("Auto Kill")

-- Main Tools
toolsFolder:AddSwitch("Auto Pushups",    function(s) states.AutoPushups    = s if s then startAutoRep("Pushups",    "AutoPushups")    end end)
toolsFolder:AddSwitch("Auto Weight",     function(s) states.AutoWeight     = s if s then startAutoRep("Weight",     "AutoWeight")     end end)
toolsFolder:AddSwitch("Auto Handstands", function(s) states.AutoHandstands = s if s then startAutoRep("Handstands", "AutoHandstands") end end)

toolsFolder:AddSwitch("Fast Punch", function(s)
    states.FastPunch = s
    if s then
        addLoop("fastPunch", task.spawn(function()
            while states.FastPunch and getgenv().NexusRunning do
                pcall(function()
                    safeFireMuscle("punch", "rightHand")
                    safeFireMuscle("punch", "leftHand")
                    local char = LocalPlayer.Character
                    if char then
                        local punch = char:FindFirstChild("Punch") or LocalPlayer.Backpack:FindFirstChild("Punch")
                        if punch and punch.Parent ~= char then char.Humanoid:EquipTool(punch) end
                        if punch and punch.Parent == char then
                            local atk = punch:FindFirstChild("attackTime")
                            if atk and atk:IsA("NumberValue") then atk.Value = 0.01 end
                            punch:Activate()
                        end
                    end
                end)
                task.wait(0.09)
            end
        end))
    end
end)

toolsFolder:AddSwitch("Fast Strength", function(s) toggleFastStrength(s) end)

toolsFolder:AddSwitch("Infinite Jump", function(s) toggleInfiniteJump(s) end)
toolsFolder:AddSwitch("Anti-AFK",      function(s) toggleAntiAfk(s)      end):Set(true)

toolsFolder:AddButton("Anti Lag (FPS Boost)", function()
    local Lighting = game:GetService("Lighting")
    Lighting.GlobalShadows = false
    Lighting.Brightness = 1
    Lighting.ClockTime = 12
    Lighting.FogEnd = 9999
    Lighting.FogStart = 0
    for _, v in Workspace:GetDescendants() do
        if v:IsA("ParticleEmitter") or v:IsA("Smoke") or v:IsA("Fire") or v:IsA("Sparkles") or
           v:IsA("BloomEffect") or v:IsA("BlurEffect") or v:IsA("DepthOfFieldEffect") or v:IsA("SunRaysEffect") then
            v.Enabled = false
        end
    end
    settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
end)

-- Teleports (positions probably outdated)
teleportTab:AddButton("Spawn/Safe",     function() safeTp(Vector3.new(-6,   5, -196))   end)
teleportTab:AddButton("Muscle King",    function() safeTp(Vector3.new(-8646,17,-5738)) end)
teleportTab:AddButton("Legend Area",    function() safeTp(Vector3.new(4603,990,-3898)) end)
-- add others if you want...

-- Rock Farm
rockFarmFolder:AddSwitch("Tiny Island (0)",       function(s) setRockFarm(0,        s) end)
rockFarmFolder:AddSwitch("Starter (100)",         function(s) setRockFarm(100,      s) end)
rockFarmFolder:AddSwitch("Legend Beach (5k)",     function(s) setRockFarm(5000,     s) end)
rockFarmFolder:AddSwitch("Frost Gym (150k)",      function(s) setRockFarm(150000,   s) end)
rockFarmFolder:AddSwitch("Mythical (400k)",       function(s) setRockFarm(400000,   s) end)
rockFarmFolder:AddSwitch("Eternal (750k)",        function(s) setRockFarm(750000,   s) end)
rockFarmFolder:AddSwitch("Legend Gym (1M)",       function(s) setRockFarm(1000000,  s) end)
rockFarmFolder:AddSwitch("Muscle King (5M)",      function(s) setRockFarm(5000000,  s) end)
rockFarmFolder:AddSwitch("Ancient Jungle (10M)",  function(s) setRockFarm(10000000, s) end)
rockFarmFolder:AddButton("STOP Rock Farm", function()
    vars.rockFarmActive = false
    vars.selectedRockDur = 0
end)

-- Killer Tab
killerTab:AddSwitch("Kill Aura (All) - HIGH BAN RISK", function(s)
    states.KillAura = s
    if s then
        warn("Kill aura → almost guaranteed ban in 2026")
        addLoop("killaura", task.spawn(function()
            while states.KillAura and getgenv().NexusRunning do
                for _, plr in Players:GetPlayers() do
                    if plr ~= LocalPlayer then killPlayer(plr) end
                end
                task.wait(0.12)
            end
        end))
    end
end)

local targetDropdown = killerTab:AddDropdown("Select Target", function(val)
    vars.selectedTarget = val and val:match("^([^|]+)") or nil
    print("Target →", vars.selectedTarget or "none")
end)

killerTab:AddSwitch("Auto Kill Selected", function(s)
    states.AutoKillSelected = s
    if s and vars.selectedTarget then
        addLoop("autokill", task.spawn(function()
            while states.AutoKillSelected and getgenv().NexusRunning do
                local plr = Players:FindFirstChild(vars.selectedTarget)
                if plr then killPlayer(plr) end
                task.wait(0.12)
            end
        end))
    end
end)

-- Player list updater
task.spawn(function()
    while getgenv().NexusRunning do
        local opts = {}
        for _, plr in Players:GetPlayers() do
            if plr ~= LocalPlayer then
                table.insert(opts, plr.Name .. " | " .. (plr.DisplayName or plr.Name))
            end
        end
        targetDropdown:SetValues(opts)
        task.wait(2)
    end
end)

-- Rebirth Tab (consolidated)
rebirthTab:AddSwitch("Auto Rebirth (Infinite)", function(s)
    states.AutoRebirth = s
    if s and rebirthRemote then
        addLoop("autorebirth", task.spawn(function()
            while states.AutoRebirth and getgenv().NexusRunning do
                pcall(function() rebirthRemote:InvokeServer("rebirthRequest") end)
                task.wait(0.1)
            end
        end))
    end
end)

rebirthTab:AddInput("Target Rebirths", function(val)
    local n = tonumber(val)
    if n and n > 0 then vars.targetRebirths = n end
end)

rebirthTab:AddSwitch("Auto Rebirth → Target", function(s)
    states.AutoRebirthTarget = s
    if s and rebirthRemote then
        addLoop("targetrebirth", task.spawn(function()
            while states.AutoRebirthTarget and getgenv().NexusRunning do
                local rebirths = LocalPlayer.leaderstats and LocalPlayer.leaderstats:FindFirstChild("Rebirths")
                if rebirths and rebirths.Value >= vars.targetRebirths then
                    states.AutoRebirthTarget = false
                    return
                end
                pcall(function() rebirthRemote:InvokeServer("rebirthRequest") end)
                task.wait(0.12)
            end
        end))
    end
end)

rebirthTab:AddSwitch("Fast Rebirth (OP spam)", function(s)
    vars.fastRebirthActive = s
    if s and rebirthRemote then
        addLoop("fastrebirth", task.spawn(function()
            while vars.fastRebirthActive and getgenv().NexusRunning do
                pcall(function() rebirthRemote:InvokeServer("rebirthRequest") end)
                task.wait(0.08)
            end
        end))
    end
end)

rebirthTab:AddSwitch("Fast Grind / Attack", function(s)
    vars.fastGrindActive = s
    if s then
        addLoop("fastgrind", task.spawn(function()
            while vars.fastGrindActive and getgenv().NexusRunning do
                pcall(function()
                    safeFireMuscle("punch", "rightHand")
                    safeFireMuscle("punch", "leftHand")
                end)
                task.wait(0.09)
            end
        end))
    end
end)

rebirthTab:AddSwitch("Auto Size 2", function(s)
    states.AutoSize2 = s
    if s then
        addLoop("autosize2", task.spawn(function()
            while states.AutoSize2 and getgenv().NexusRunning do
                pcall(function()
                    local remote = rEvents and rEvents:FindFirstChild("changeSpeedSizeRemote")
                    if remote then remote:InvokeServer("changeSize", 2) end
                end)
                task.wait(0.08)
            end
        end))
    end
end)

rebirthTab:AddSwitch("Auto TP Muscle King", function(s)
    states.AutoMuscleKing = s
    if s then
        addLoop("kingtp", task.spawn(function()
            while states.AutoMuscleKing and getgenv().NexusRunning do
                safeTp(Vector3.new(-8646, 17, -5738))
                task.wait(0.15)
            end
        end))
    end
end)

-- Stats Tab (basic display)
local LeaderParagraph = statsTab:AddLabel("Leaderstats: loading...")
local IntParagraph    = statsTab:AddLabel("Int stats: loading...")

local function formatNumber(n)
    local s = tostring(math.floor(n))
    local k
    repeat
        s, k = string.gsub(s, "^(-?%d+)(%d%d%d)", '%1,%2')
    until k == 0
    return s
end

local function formatTime(sec)
    local d = math.floor(sec / 86400)
    local h = math.floor((sec % 86400) / 3600)
    local m = math.floor((sec % 3600) / 60)
    local s = sec % 60
    return string.format("%dd %dh %dm %ds", d, h, m, s)
end

local sessionStart = os.time()

RunService.RenderStepped:Connect(function()
    local ls = LocalPlayer:FindFirstChild("leaderstats")
    local strength  = ls and ls:FindFirstChild("Strength")  and ls.Strength.Value  or 0
    local rebirths  = ls and ls:FindFirstChild("Rebirths")  and ls.Rebirths.Value  or 0
    local kills     = ls and ls:FindFirstChild("Kills")     and ls.Kills.Value     or 0
    local brawls    = ls and ls:FindFirstChild("Brawls")    and ls.Brawls.Value    or 0

    local goodK  = LocalPlayer:FindFirstChild("goodKarma")  and LocalPlayer.goodKarma.Value  or 0
    local evilK  = LocalPlayer:FindFirstChild("evilKarma")  and LocalPlayer.evilKarma.Value  or 0
    local dur    = LocalPlayer:FindFirstChild("Durability") and LocalPlayer.Durability.Value or 0
    local agi    = LocalPlayer:FindFirstChild("Agility")    and LocalPlayer.Agility.Value    or 0
    local mkTime = LocalPlayer:FindFirstChild("muscleKingTime") and LocalPlayer.muscleKingTime.Value or 0

    local session = os.time() - sessionStart

    LeaderParagraph:SetContent(string.format(
        "Strength: %s\nRebirths: %s\nKills: %s\nBrawls: %s\nSession: %s",
        formatNumber(strength), formatNumber(rebirths), formatNumber(kills), formatNumber(brawls), formatTime(session)
    ))

    IntParagraph:SetContent(string.format(
        "Good Karma: %s\nEvil Karma: %s\nDurability: %s\nAgility: %s\nMuscle King: %s",
        formatNumber(goodK), formatNumber(evilK), formatNumber(dur), formatNumber(agi), formatNumber(mkTime)
    ))
end)

print("Invincible Paid - cleaned & fixed (Feb 2026)")
print("Warning: Most aggressive features (kill aura, fast rebirth spam, touch farm) → high ban risk in current games.")
